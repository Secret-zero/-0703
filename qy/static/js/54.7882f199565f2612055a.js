webpackJsonp([54],{gaHo:function(t,e){},"sGV+":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Xxa5"),i=s.n(a),r=s("exGp"),o=s.n(r),n=s("Dd8w"),c=s.n(n),l=s("1h8J"),u=s("NYxO"),p=s("7t+N"),v=s.n(p),d=s("FT/c"),f=s("uaSg"),m=(c()({},Object(u.b)({wxOpenId:function(t){return t.mutations.wxOpenId},userInfo:function(t){return t.mutations.userInfo}})),{data:function(){return{sessionCodeDisplay:!1,resultDisplay:!1,sessionCode:"666666",sessionList:[],videoSrc:"",videoNum:"",resultMessage:"",verifyMessage:"",verifyCode:"",score:0,create:0,identify:0,matchMessage:"",matchScore:0,imgSrc:"//aip.bdstatic.com/faceliveness/dist/1523595724898/images/pic_default.png",loadingDisplay:!1}},computed:c()({},Object(u.b)({wxOpenId:function(t){return t.mutations.wxOpenId},userInfo:function(t){return t.mutations.userInfo}})),mounted:function(){console.info(1),v()("html").addClass("body-bg"),console.info(document.body.clientWidth)},methods:{getSessioncode:function(){var t=this;return o()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.sessionCodeDisplay=!0,t.sessionList=t.sessionCode.split(""),console.info(t.sessionCode.split(""),t.sessionList);case 3:case"end":return e.stop()}},e,t)}))()},imgChange:function(){this.loadingDisplay=!0;var t=event.target.files||event.dataTransfer.files;if(t&&t.length>0){var e=t[0];if(console.info(e),console.info(e.size/1024/1024+"MB"),e.size>20971520)confirm("您录制的视频时间过大,请重新录制");else{var s=this,a=event.target.files[0],i=new FileReader;i.readAsDataURL(a);i.onload=function(t){var a=document.createElement("canvas"),i=a.getContext("2d"),r=new Image,o=1;r.setAttribute("crossOrigin","Anonymous"),r.src=s.userInfo[0].FPicUrl,r.onload=function(){if(r.height*r.width<=64e4)console.log("像素小于等于64万"),a.height=r.height,a.width=r.width;else{console.log("大于64万像素");var t=Math.sqrt(r.height*r.width/64e4);a.height=r.height/t,a.width=r.width/t}i.drawImage(r,0,0,a.width,a.height);var n=a.toDataURL("image/jpeg",o),c=n.length,l=parseInt(c-c/8*2),u="";for(u=(l/1024).toFixed(2);parseInt(u)>200;)o*=.99,c=(n=a.toDataURL("image/jpeg",o)).length,u=((l=parseInt(c-c/8*2))/1024).toFixed(2);console.info(n.replace(/.*;base64,/,""));var p=new FormData;p.append("video",e),p.append("image",n.replace(/.*;base64,/,""));d.a.post(f.b+"/TransferService.asmx/GetMatch1",p,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(s.loadingDisplay=!1,t=v.a.parseXML(t.data).firstChild.textContent,t=decodeURIComponent(t),"success"===(t=JSON.parse(t)).ReturnType||"S"===t.ReturnType){s.resultMessage=t.ReturnMsg;var e=t.ReturnMsg;if(0===e.verify.error_code)s.verifyMessage="成功",s.score=e.verify.result.score,e.verify.result.code&&(s.create=e.verify.result.code.create,s.identify=e.verify.result.code.identify),s.imgSrc="data:image/png;base64,"+e.verify.result.pic_list[0].pic;else{s.verifyMessage="失败",s.verifyCode=function(){switch(e.verify.error_code){case 216501:return"没有找到人脸";case 216434:return"活体检测失败";case 216507:return"视频中有多张脸";default:return"服务器异常"}}()}0===e.match.error_code?(s.matchMessage="成功",s.matchScore=e.match.result.score):(s.matchMessage="失败",s.matchScore=0),s.resultDisplay=!0,s.sessionCodeDisplay=!1}else vue.$vux.toast.text(t.ReturnMsg),console.log(t.ReturnMsg);console.log(t)}).catch(function(t){console.log(t)}),console.log(s.resultMessage)}}}}},getMatch:function(t,e){var s=this;return o()(i.a.mark(function a(){var r,o;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(l.q)({video:t,image:e});case 2:r=a.sent,s.resultMessage=r,0===r.verify.error_code?(s.verifyMessage="成功",s.score=r.verify.result.score,r.verify.result.code&&(s.create=r.verify.result.code.create,s.identify=r.verify.result.code.identify),s.imgSrc="data:image/png;base64,"+r.verify.result.pic_list[0].pic):(o=function(){switch(r.verify.error_code){case 216501:return"没有找到人脸";case 216434:return"活体检测失败";case 216507:return"视频中有多张脸";default:return"服务器异常"}},s.verifyMessage="失败",s.verifyCode=o()),0===r.match.error_code?(s.matchMessage="成功",s.matchScore=r.match.result.score):(s.matchMessage="失败",s.matchScore=0),s.resultDisplay=!0,s.sessionCodeDisplay=!1;case 8:case"end":return a.stop()}},a,s)}))()}}}),_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"body-bg"},[s("a",{attrs:{href:"https://ai.baidu.com/face-verify/mobile.html"}},[t._v("链接")]),t._v(" "),t._m(0),t._v(" "),s("div",{staticClass:"prompt"},[t._m(1),t._v(" "),s("span",{staticClass:"prompt-next",on:{click:function(e){return t.getSessioncode()}}},[t._v("下一步")])]),t._v(" "),t.sessionCodeDisplay?s("div",{staticClass:"modal-layer"},[s("div",{staticClass:"modal-layer-mask"}),t._v(" "),s("div",{staticClass:"modal-layer-popup"},[s("div",{staticClass:"modal-layer-success"},[s("div",{staticClass:"modal-layer-popup-title"},[t._v("请牢记以下验证码")]),t._v(" "),t._m(2),t._v(" "),s("div",{staticClass:"modal-layer-popup-number"},t._l(t.sessionList,function(e,a){return s("span",{key:a},[t._v(t._s(e))])}),0),t._v(" "),s("div",{staticClass:"modal-wrapper modal-point"},[s("span",{staticClass:"modal-confirm-btn"},[t._v("记住了，开始录制")]),t._v(" "),s("form",{attrs:{id:"myform"}},[s("input",{staticClass:"camera-input",attrs:{type:"file",accept:"video/*",capture:"user"},on:{change:t.imgChange}})])])]),t._v(" "),s("span",{staticClass:"modal-layer-close",on:{click:function(e){t.sessionCodeDisplay=!1}}})])]):t._e(),t._v(" "),t.resultDisplay?s("div",{staticClass:"result"},[s("div",{staticClass:"result-box"},[s("span",{staticClass:"result-box-pic"},[s("span",{staticClass:"result-box-pic-icon icon-top"}),t._v(" "),s("span",{staticClass:"result-box-pic-icon icon-right"}),t._v(" "),s("span",{staticClass:"result-box-pic-icon icon-bottom"}),t._v(" "),s("span",{staticClass:"result-box-pic-icon icon-left"}),t._v(" "),s("img",{staticClass:"result-box-return-img",attrs:{src:t.imgSrc}})]),t._v(" "),s("span",{staticClass:"result-box-text"},[s("div",[t._v("活体检测\n\t\t\t\t\t"),s("span",{staticClass:"result-box-color resulr-color-red"},[t._v(t._s(t.verifyMessage))]),t._v(" "),s("span",{staticClass:"result-box-failcolor"},[t._v(t._s(t.verifyCode))])]),t._v(" "),s("div",[t._v("图象对比\n\t\t\t\t\t"),s("span",{staticClass:"result-box-color resulr-color-red"},[t._v(t._s(t.matchMessage))])])]),t._v(" "),s("div",{staticClass:"result-box-value"},[s("span",{staticClass:"result-box-value-text"},[t._v("检测分值:"+t._s(t.score))]),t._v(" "),s("span",{staticClass:"result-box-value-text"},[t._v("应读数字:"+t._s(t.create))]),t._v(" "),s("span",{staticClass:"result-box-value-text"},[t._v("检测数字:"+t._s(t.identify))]),t._v(" "),s("span",{staticClass:"result-box-value-text"},[t._v("对比分值:"+t._s(t.matchScore))])])]),t._v(" "),s("div",{staticClass:"result-option"},[s("span",{staticClass:"result-option-btn result-option-btn-ok"},[t._v("完成")]),t._v(" "),s("span",{staticClass:"result-option-btn result-option-btn-again",on:{click:function(e){t.resultDisplay=!1,t.sessionCodeDisplay=!0}}},[t._v("重拍")])])]):t._e(),t._v(" "),t.loadingDisplay?s("div",{staticClass:"loading"},[s("div",{staticClass:"loading-icon"},[t._v("验证中...")])]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"sketch"},[e("div",{staticClass:"sketch-img"}),this._v(" "),e("p",{staticClass:"sketch-text"},[this._v("\n\t\t\t正面平视手机、保证光线充足\n\t\t\t"),e("br"),this._v("请勿遮挡面部\n\t\t")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"prompt-box"},[s("div",{staticClass:"prompt-box-text"},[s("span",{staticClass:"prompt-box-text-number"},[t._v("1")]),t._v(" "),s("span",{staticClass:"prompt-box-text-content"},[t._v("牢记验证码，点击开始录制")]),t._v(" "),s("span",{staticClass:"prompt-box-text-border"})]),t._v(" "),s("div",{staticClass:"prompt-box-text"},[s("span",{staticClass:"prompt-box-text-number"},[t._v("2")]),t._v(" "),s("span",{staticClass:"prompt-box-text-content"},[t._v("开启前置摄像头，用普通话朗读数字")]),t._v(" "),s("span",{staticClass:"prompt-box-text-border"})]),t._v(" "),s("div",{staticClass:"prompt-box-text"},[s("span",{staticClass:"prompt-box-text-number"},[t._v("3")]),t._v(" "),s("span",{staticClass:"prompt-box-text-content"},[t._v("完成录制，等待验证结果")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-layer-popup-content"},[this._v("\n\t\t\t\t\t此验证码将于\n\t\t\t\t\t"),e("span",[this._v("60")]),this._v("秒后过期\n\t\t\t\t\t"),e("br"),this._v("用普通话朗读数字，视频时长\n\t\t\t\t\t"),e("span",[this._v("3-8")]),this._v("秒最佳\n\t\t\t\t")])}]};var h=s("VU/8")(m,_,!1,function(t){s("gaHo")},null,null);e.default=h.exports}});
//# sourceMappingURL=54.7882f199565f2612055a.js.map